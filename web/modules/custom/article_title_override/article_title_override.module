<?php

/**
 * @file
 * Primary module hooks for Article Title Override module.
 */

use Drupal\article_title_override\Event\NodePresaveEvent;
use Drupal\Component\Utility\NestedArray;
use Drupal\Core\Datetime\DrupalDateTime;
use Drupal\Core\Entity\EntityInterface;

/**
 * Implements hook_preprocess_HOOK().
 */
function article_title_override_preprocess_page(&$variables) {
  $parents = ['page', 'content', 'bartik_page_title', '#block'];
  $block_title = NestedArray::keyExists($variables, $parents);

  if ($block_title) {
    $variables['page']['content']['bartik_page_title']['#block'] = NULL;

  }

}

/**
 * Implements hook_entity_insert().
 */
function article_title_override_entity_insert(EntityInterface $entity) {
  if ($entity->getEntityTypeId() == 'node' || $entity->getType() == 'article') {
    /** @var \Drupal\Component\EventDispatcher\ContainerAwareEventDispatcher $event_dispatcher */
    $event_dispatcher = Drupal::service('event_dispatcher');

    $event = new NodePresaveEvent($entity);

    $event_dispatcher->dispatch(NodePresaveEvent::NODE_PRESAVE, $event );

  }

}
